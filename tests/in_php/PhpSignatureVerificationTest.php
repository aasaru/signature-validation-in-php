<?php

namespace in_php;

use PHPUnit\Framework\TestCase;

class PhpSignatureVerificationTest  extends TestCase {

  public const CERTIFICATE_BASE64 = "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";
  public const PEM_CERTIFICATE = "-----BEGIN CERTIFICATE-----\n" . PhpSignatureVerificationTest::CERTIFICATE_BASE64 . "\n-----END CERTIFICATE-----";

  public const DATA_BASE64 = 'icRrt6/Jqf8yIOv0tzpfxsK1RY8CQTtWKWxNwjDxN7ZF16bdVdBTnk1XA/zWeURB3WnHCLSz6fiF4Su5aOEkjg==';
  public const SIGNATURE_BASE64 = "L0SgtDyF0DbRe0zmoGWD79HHwY6M1TM7I7KMBJMiXWj671Izj4vBn1S5X3UBEyLCZC59prHsMZ9mtCYSER5ryvai5l8QBYWIIbw51t31qZ3NwpPdxgdN82Cv3foa5TXsHtpIjN7qXpIJsvSoLoaJ+PbwBErcPujwnC8tJMu6RSC1VOwdXmKHX8wDMk0JiOMsj3p1nETbeVukh6q14B42e4s+FWB0MBKqiO3Gft/kvGRTlslDNaxJZDtLF+zs4jwNDD4rIbzl8HR5aAKBK9txZrtDA61LiUgMKd4xA29dEYwt8hruT4Yttj/OcKbw0twSAWUlT8uFMh90XyVZGOMJdZvJs7m6k8x/+y2nNmRDuZFywrLpkQC4wczTTTwrJOISwbYJFmss/t3GvjbOCouskQ1m1jeXtUqzd9KADg54x94UWr69j+DLxQFq7uzFMeQBZnf/en2UsM1WU4rGVNPQSJuGGA+ixDqyF9WVZlTe8QTWYl990cRlUeZAT6s4OP1zLNgMuJapI82MhUtdfjRVzFx2sTIxHVtqrFhIvw+NdYqb4o6Yjh5YRCFNcsIk1KCgdBtKT09CDTWPbdFptwqAH+Ag1TnaB/z0ldFau0SQJnHyGgKFGJRVBj88nrxio9qpQkly8ysEMo4gDnp1pwcbw9AW4gxWzgfANjRlmZ7N2FKEzFYZhn4bzoe1CrHEMOEn5ifToy2rLwvlSQqh5k3xiLqPmr9mCCah6B9WYESKvi++EKEJGliH0VkGwnXlwMYZipuvdys73ejFO1rTUNym4xYbz6xDHjuvQDvfQhvm0xNaO2HbT7FtT017MA+uBQC+Q1yd/IEYfWsjRLw9Jq1RESbHGyQM9aMlHQnqr37VEgFfG2gbcOHwHR2/C7l6BEL5ESgvWeqvkB7ACxG5yHLQYgqmw0xub5wS17A4eLcSWDkEmgYjjBMVugWdOq2YFAcQfF+aORUIZC2PYjpRyUWnQB+8RAnTvE2sTWlHPXgzMVGPsyAAtC4dlv9k6+X7xDQC";


  public function testVerifySignature(): void
  {

    $signedDataBinary = base64_decode(PhpSignatureVerificationTest::DATA_BASE64);
    $signedDataDigestBinary = hash( 'sha512', PhpSignatureVerificationTest::DATA_BASE64, true );

    $signatureBinary = base64_decode(PhpSignatureVerificationTest::SIGNATURE_BASE64);

    $publicKey = openssl_pkey_get_public( PhpSignatureVerificationTest::PEM_CERTIFICATE );

    $result = Verification::isSignatureCorrect($signedDataBinary, $signatureBinary, $publicKey, OPENSSL_ALGO_SHA512);

    self::assertTrue($result);
  }

}